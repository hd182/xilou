var egret=window.egret,__reflect=this&&this.__reflect||function(e,t,o){e.__class__=t,o?o.push(t):o=[t],e.__types__=e.__types__?o.concat(e.__types__):o},__extends=this&&this.__extends||function(e,t){function o(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);o.prototype=t.prototype,e.prototype=new o},__awaiter=this&&this.__awaiter||function(e,t,o,r){return new(o||(o=Promise))(function(i,n){function a(e){try{l(r.next(e))}catch(t){n(t)}}function s(e){try{l(r["throw"](e))}catch(t){n(t)}}function l(e){e.done?i(e.value):new o(function(t){t(e.value)}).then(a,s)}l((r=r.apply(e,t||[])).next())})},__generator=this&&this.__generator||function(e,t){function o(e){return function(t){return r([e,t])}}function r(o){if(i)throw new TypeError("Generator is already executing.");for(;l;)try{if(i=1,n&&(a=n[2&o[0]?"return":o[0]?"throw":"next"])&&!(a=a.call(n,o[1])).done)return a;switch(n=0,a&&(o=[0,a.value]),o[0]){case 0:case 1:a=o;break;case 4:return l.label++,{value:o[1],done:!1};case 5:l.label++,n=o[1],o=[0];continue;case 7:o=l.ops.pop(),l.trys.pop();continue;default:if(a=l.trys,!(a=a.length>0&&a[a.length-1])&&(6===o[0]||2===o[0])){l=0;continue}if(3===o[0]&&(!a||o[1]>a[0]&&o[1]<a[3])){l.label=o[1];break}if(6===o[0]&&l.label<a[1]){l.label=a[1],a=o;break}if(a&&l.label<a[2]){l.label=a[2],l.ops.push(o);break}a[2]&&l.ops.pop(),l.trys.pop();continue}o=t.call(e,l)}catch(r){o=[6,r],n=0}finally{i=a=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}var i,n,a,s,l={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:o(0),"throw":o(1),"return":o(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s},AssetAdapter=function(){function e(){}return e.prototype.getAsset=function(e,t,o){function r(r){t.call(o,r,e)}if(RES.hasRes(e)){var i=RES.getRes(e);i?r(i):RES.getResAsync(e,r,this)}else RES.getResByUrl(e,r,this,RES.ResourceItem.TYPE_IMAGE)},e}();__reflect(AssetAdapter.prototype,"AssetAdapter",["eui.IAssetAdapter"]);var LoadingUI=function(e){function t(){var t=e.call(this)||this;return t.createView(),t}return __extends(t,e),t.prototype.createView=function(){this.textField=new egret.TextField,this.addChild(this.textField),this.textField.y=300,this.textField.width=480,this.textField.height=100,this.textField.textAlign="center"},t.prototype.onProgress=function(e,t){this.textField.text="Loading..."+e+"/"+t},t}(egret.Sprite);__reflect(LoadingUI.prototype,"LoadingUI",["RES.PromiseTaskReporter"]);var Main=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.createChildren=function(){e.prototype.createChildren.call(this),egret.lifecycle.addLifecycleListener(function(e){}),egret.lifecycle.onPause=function(){egret.ticker.pause()},egret.lifecycle.onResume=function(){egret.ticker.resume()};var t=new AssetAdapter;egret.registerImplementation("eui.IAssetAdapter",t),egret.registerImplementation("eui.IThemeAdapter",new ThemeAdapter),this.runGame()["catch"](function(e){console.log(e)})},t.prototype.runGame=function(){return __awaiter(this,void 0,void 0,function(){var e,t;return __generator(this,function(o){switch(o.label){case 0:return[4,this.loadResource()];case 1:return o.sent(),this.createGameScene(),[4,RES.getResAsync("description_json")];case 2:return e=o.sent(),this.startAnimation(e),[4,platform.login()];case 3:return o.sent(),[4,platform.getUserInfo()];case 4:return t=o.sent(),console.log(t),[2]}})})},t.prototype.loadResource=function(){return __awaiter(this,void 0,void 0,function(){var e,t;return __generator(this,function(o){switch(o.label){case 0:return o.trys.push([0,4,,5]),e=new LoadingUI,this.stage.addChild(e),[4,RES.loadConfig("resource/default.res.json","resource/")];case 1:return o.sent(),[4,this.loadTheme()];case 2:return o.sent(),[4,RES.loadGroup("preload",0,e)];case 3:return o.sent(),this.stage.removeChild(e),[3,5];case 4:return t=o.sent(),console.error(t),[3,5];case 5:return[2]}})})},t.prototype.loadTheme=function(){var e=this;return new Promise(function(t,o){var r=new eui.Theme("resource/default.thm.json",e.stage);r.addEventListener(eui.UIEvent.COMPLETE,function(){t()},e)})},t.prototype.createGameScene=function(){this.addChild(new beginGame)},t.prototype.createBitmapByName=function(e){var t=new egret.Bitmap,o=RES.getRes(e);return t.texture=o,t},t.prototype.startAnimation=function(e){var t=this,o=new egret.HtmlTextParser,r=e.map(function(e){return o.parse(e)}),i=this.textfield,n=-1,a=function(){n++,n>=r.length&&(n=0);var e=r[n];i.textFlow=e;var o=egret.Tween.get(i);o.to({alpha:1},200),o.wait(2e3),o.to({alpha:0},200),o.call(a,t)};a()},t.prototype.onButtonClick=function(e){var t=new eui.Panel;t.title="Title",t.horizontalCenter=0,t.verticalCenter=0,this.addChild(t)},t}(eui.UILayer);__reflect(Main.prototype,"Main");var DebugPlatform=function(){function e(){}return e.prototype.getUserInfo=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2,{nickName:"username"}]})})},e.prototype.login=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2]})})},e}();__reflect(DebugPlatform.prototype,"DebugPlatform",["Platform"]),window.platform||(window.platform=new DebugPlatform);var ThemeAdapter=function(){function e(){}return e.prototype.getTheme=function(e,t,o,r){function i(e){t.call(r,e)}function n(t){t.resItem.url==e&&(RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,n,null),o.call(r))}var a=this;if("undefined"!=typeof generateEUI)egret.callLater(function(){t.call(r,generateEUI)},this);else if("undefined"!=typeof generateEUI2)RES.getResByUrl("resource/gameEui.json",function(e,o){window.JSONParseClass.setData(e),egret.callLater(function(){t.call(r,generateEUI2)},a)},this,RES.ResourceItem.TYPE_JSON);else if("undefined"!=typeof generateJSON)if(e.indexOf(".exml")>-1){var s=e.split("/");s.pop();var l=s.join("/")+"_EUI.json";generateJSON.paths[e]?egret.callLater(function(){t.call(r,generateJSON.paths[e])},this):RES.getResByUrl(l,function(o){window.JSONParseClass.setData(o),egret.callLater(function(){t.call(r,generateJSON.paths[e])},a)},this,RES.ResourceItem.TYPE_JSON)}else egret.callLater(function(){t.call(r,generateJSON)},this);else RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,n,null),RES.getResByUrl(e,i,this,RES.ResourceItem.TYPE_TEXT)},e}();__reflect(ThemeAdapter.prototype,"ThemeAdapter",["eui.IThemeAdapter"]);var beginGame=function(e){function t(){var t=e.call(this)||this;return t.ifstart=!1,t.colorList=[16711680,65280,255,16777215],t.jiugeData=[[],[],[],[],[],[],[],[],[]],t.hanldNum=0,t.score=0,t.succerrRecord=[0,1,2],t.skinName="beginGameSkin",t.addEventListener(egret.Event.ADDED_TO_STAGE,t.init,t),t}return __extends(t,e),t.prototype.init=function(){this.sorceText.text=this.score.toString(),this.jiulist.itemRenderer=jiugeItem,this.jiuListData=new eui.ArrayCollection(this.jiugeData),this.jiulist.dataProvider=this.jiuListData;this.jsons=[[{status:!0,color:0},{status:!1,color:0},{status:!0,color:2}],[{status:!1,color:0},{status:!1,color:0},{status:!0,color:2}],[{status:!0,color:0},{status:!0,color:0},{status:!0,color:2}]],this.randomInitQuanData()},t.prototype.randomInitQuanData=function(){for(var e=[],t=0;3>t;t++){e[t]=[];for(var o=0;3>o;o++){var r=this.score>20?Math.floor(4*Math.random()):Math.floor(3*Math.random());2!=o||e[t][0].status||e[t][1].status?e[t].push({status:Math.random()>.5,color:r}):e[t].push({status:!0,color:r})}}this.jsons=e,this.initQuan(e)},t.prototype.initQuan=function(e){for(var t=0;t<e.length;t++){this["shp"+t]=new egret.Shape,this["shp"+t].x=90*(t+1)+120*(t+.5),this["shp"+t].y=this.jiuBox.y+this.jiuBox.height+120+20,this["shp"+t].graphics.lineStyle(0,16777215),this["shp"+t].graphics.beginFill(16711680,0),this["shp"+t].graphics.drawCircle(0,0,80),this["shp"+t].graphics.endFill();for(var o=0;3>o;o++)e[t][o].status&&(this["shp"+t].graphics.lineStyle(10,this.colorList[e[t][o].color]),this["shp"+t].graphics.beginFill(16711680,0),this["shp"+t].graphics.drawCircle(0,0,20*(o+1)),this["shp"+t].graphics.endFill());this.addChild(this["shp"+t]),this["shp"+t].touchEnabled=!0,this["shp"+t].addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.startTap.bind(this,t),this),this["shp"+t].addEventListener(egret.TouchEvent.TOUCH_MOVE,this.moveTap.bind(this,t),this),this["shp"+t].addEventListener(egret.TouchEvent.TOUCH_END,this.endTap.bind(this,t),this)}},t.prototype.setShpTouch=function(e,t){for(var o=0;3>o;o++)e!=o&&(this["shp"+o].touchEnabled=t)},t.prototype.startTap=function(e,t){this.setShpTouch(e,!1)},t.prototype.moveTap=function(e,t){this["shp"+e].x=t.stageX,this["shp"+e].y=t.stageY},t.prototype.endTap=function(e,t){var o=t.stageX,r=t.stageY,i=(this.stage.stageWidth-600)/2,n=(this.stage.stageWidth-600)/2+600,a=this.jiuBox.y+600,s=this.jiuBox.y;if(n>o&&o>i&&r>s&&a>r){console.log("在这个范围内");var l=Math.floor((o-i)/200)+1,u=Math.floor((r-s)/200)+1;if(Math.abs(200*(l-1+.5)+i-o)>50||Math.abs(200*(u-1+.5)+s-r)>50)this.samePlace(e);else{var h=3*(u-1)+(l-1);if(this.judePlace(e,h)){console.log("可以放入"),this.jiugeData[h]=this.updataJiugeData(this.jsons[e],this.jiugeData[h]);var c=this;egret.Tween.get(this["shp"+e]).to({x:200*(l-1+.5)+i,y:200*(u-1+.5)+s},100).call(function(){if(c.jiuListData.replaceItemAt(c.jiugeData[h],h),c["shp"+e].touchEnabled=!1,c["shp"+e].removeEventListener(egret.TouchEvent.TOUCH_BEGIN,c.startTap,c),c["shp"+e].removeEventListener(egret.TouchEvent.TOUCH_MOVE,c.moveTap,c),c["shp"+e].removeEventListener(egret.TouchEvent.TOUCH_END,c.endTap,c),c.removeChild(c["shp"+e]),c.setShpTouch(e,!0),c.returnZuoBiao(h),c.hanldNum++,c.succerrRecord.splice(c.succerrRecord.indexOf(e),1),c.hanldNum>=3&&(c.hanldNum=0,c.randomInitQuanData()),c.succerrRecord.length<=0&&(c.succerrRecord=[0,1,2]),c.judeFail());else{console.log("----------无可放--------------");var t=new eui.Label;t.text="没有可放的地方了",t.textColor=16777215,t.size=32,t.width=500,t.height=60,t.x=(c.stage.width-t.width)/2,t.y=(c.stage.height-t.height)/2,c.addChild(t),setTimeout(function(){c.removeChild(t)},3e3)}})}else this.samePlace(e)}}else this.samePlace(e)},t.prototype.judeFail=function(){var e=!1;console.log("this.jiuListData.length字节：",this.jiuListData.length);for(var t=0;t<this.jiuListData.length;t++)for(var o=0;o<this.succerrRecord.length;o++)this.judePlace(this.succerrRecord[o],t)&&(e=!0);return e},t.prototype.samePlace=function(e){var t=this;egret.Tween.get(this["shp"+e]).to({x:90*(e+1)+120*(e+.5),y:this.jiuBox.y+this.jiuBox.height+120+20},200).call(function(){t.setShpTouch(-1,!0)})},t.prototype.judePlace=function(e,t){for(var o=!0,r=0;r<this.jiugeData[t].length;r++)if(this.jsons[e][r].status&&this.jiugeData[t][r].status){o=!1;break}return o},t.prototype.updataJiugeData=function(e,t){if(t.length<1)t=e;else for(var o=0;3>o;o++)e[o].status&&(t[o]=e[o]);return t},t.prototype.judeRemove=function(e){var t=[1,3,5,7],o=[0,2,6,8];if(4==e)console.log("横向",this.judeColorSame(e+1,e,e-1)),console.log("竖向",this.judeColorSame(e-3,e,e+3)),console.log("斜向1",this.judeColorSame(e-4,e,e+4)),console.log("斜向2",this.judeColorSame(e-2,e,e+2));else if(-1!=t.indexOf(e))switch(e){case 1:var r=this.judeColorSame(e-1,e,e+1),i=this.judeColorSame(e,e+3,e+6);console.log("横向",r),console.log("竖向",i);break;case 3:var n=this.judeColorSame(e,e+1,e+2),a=this.judeColorSame(e-3,e,e+3);console.log("横向",n),console.log("竖向",a);break;case 5:console.log("横向",this.judeColorSame(e,e-1,e-2)),console.log("竖向",this.judeColorSame(e-3,e,e+3));break;case 7:console.log("横向",this.judeColorSame(e-1,e,e+1)),console.log("竖向",this.judeColorSame(e,e-3,e-6))}else if(-1!=o.indexOf(e))switch(e){case 0:console.log("横向",this.judeColorSame(e,e+1,e+2)),console.log("竖向",this.judeColorSame(e,e+3,e+6)),console.log("斜向",this.judeColorSame(e,e+4,e+8));break;case 2:console.log("横向",this.judeColorSame(e,e-1,e-2)),console.log("竖向",this.judeColorSame(e,e+3,e+6)),console.log("斜向",this.judeColorSame(e,e+2,e+4));break;case 6:console.log("横向",this.judeColorSame(e,e+1,e+2)),console.log("竖向",this.judeColorSame(e,e-3,e-6)),console.log("斜向",this.judeColorSame(e,e-2,e-4));break;case 8:console.log("横向",this.judeColorSame(e,e-1,e-2)),console.log("竖向",this.judeColorSame(e,e-3,e-6)),console.log("斜向",this.judeColorSame(e,e-4,e-8))}},t.prototype.returnZuoBiao=function(e){var t=[1,3,5,7],o=[0,2,6,8];if(4==e)this.mergeData([this.judeColorSame(e+1,e,e-1),this.judeColorSame(e-3,e,e+3),this.judeColorSame(e-4,e,e+4),this.judeColorSame(e-2,e,e+2)]);else if(-1!=t.indexOf(e))switch(e){case 1:this.mergeData([this.judeColorSame(e-1,e,e+1),this.judeColorSame(e,e+3,e+6)]);break;case 3:var r=this.judeColorSame(e,e+1,e+2),i=this.judeColorSame(e-3,e,e+3);console.log("横向",r),console.log("竖向",i),this.mergeData([r,i]);break;case 5:this.mergeData([this.judeColorSame(e,e-1,e-2),this.judeColorSame(e-3,e,e+3)]);break;case 7:this.mergeData([this.judeColorSame(e-1,e,e+1),this.judeColorSame(e,e-3,e-6)])}else if(-1!=o.indexOf(e))switch(e){case 0:this.mergeData([this.judeColorSame(e,e+1,e+2),this.judeColorSame(e,e+3,e+6),this.judeColorSame(e,e+4,e+8)]);break;case 2:this.mergeData([this.judeColorSame(e,e-1,e-2),this.judeColorSame(e,e+3,e+6),this.judeColorSame(e,e+2,e+4)]);break;case 6:this.mergeData([this.judeColorSame(e,e+1,e+2),this.judeColorSame(e,e-3,e-6),this.judeColorSame(e,e-2,e-4)]);break;case 8:this.mergeData([this.judeColorSame(e,e-1,e-2),this.judeColorSame(e,e-3,e-6),this.judeColorSame(e,e-4,e-8)])}},t.prototype.mergeData=function(e){for(var t=[],o=[],r=0;r<e.length;r++)e[r].colorarr&&e[r].colorarr.length>0&&(t=t.concat(e[r].colorarr),t=t.filter(function(e,t,o){return o.indexOf(e)===t}),o=o.concat(e[r].indexarr),o=o.filter(function(e,t,o){return o.indexOf(e)===t}));console.log("可消除的数据:",o,t),o.length>0&&this.clearYuan(o,t)},t.prototype.clearYuan=function(e,t){for(var o=0,r=0;r<t.length;r++)for(var i=0;i<e.length;i++){var n=this.jiugeData[e[i]];console.log("循环的哪一个的数据",n,i);for(var a=0;a<n.length;a++){var s=n[a];console.log("循环小环",s,a),s&&s.status&&s.color==t[r]&&(o++,console.log("更改地方：",this.jiugeData[e[i]][a]),this.jiugeData[e[i]][a].status=!1,this.jiuListData.replaceItemAt(this.jiugeData[e[i]],e[i]))}}this.score+=o,this.sorceText.text=this.score.toString()},t.prototype.judeColorSame=function(e,t,o){if(this.jiugeData[e].length<=0||this.jiugeData[t].length<=0||this.jiugeData[o].length<=0)return console.log("没有数据"),!1;for(var r=[],i=[],n=this.returnCurrentData(e),a=this.returnCurrentData(t),s=this.returnCurrentData(o),l=0;l<this.colorList.length;l++)n[l]&&a[l]&&s[l]&&r.push(l);return r&&r.length>0&&(i[0]=e,i[1]=t,i[2]=o),{colorarr:r,indexarr:i}},t.prototype.returnCurrentData=function(e){for(var t=this.jiugeData[e],o={},r=0;r<t.length;r++)t[r]&&t[r].status&&(o[t[r].color]?o[t[r].color]=o[t[r].color]+1:o[t[r].color]=1);return console.log("这时候里面的数据",o),o},t}(eui.Component);__reflect(beginGame.prototype,"beginGame");var BoxPalen=function(e){function t(){var t=e.call(this)||this;return t.skinName="boxSkin",t}return __extends(t,e),Object.defineProperty(t.prototype,"data",{get:function(){return this.lab.text},set:function(e){this.lab.text=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"label",{get:function(){return this.lab.text},set:function(e){this.lab.text=e},enumerable:!0,configurable:!0}),t}(eui.Component);__reflect(BoxPalen.prototype,"BoxPalen");var Play=function(e){function t(){var t=e.call(this)||this;return t.skinName="playSkin",t.addEventListener(egret.Event.ADDED_TO_STAGE,t.init,t),t}return __extends(t,e),t.prototype.init=function(){for(var e=0;16>e;e++){var t=new BoxPalen;t.data=e,this.mainGroup.addChild(t),t.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.beginTap,this),t.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.moveTap,this),t.addEventListener(egret.TouchEvent.TOUCH_END,this.endTap,this)}},t.prototype.beginTap=function(e){console.log(e)},t.prototype.moveTap=function(e){console.log(e)},t.prototype.endTap=function(e){console.log(e)},t}(eui.Component);__reflect(Play.prototype,"Play");var jiugeItem=function(e){function t(){var t=e.call(this)||this;return t.colorList=[16711680,65280,255,16777215],t.skinName="jiugeItmSkin",t}return __extends(t,e),t.prototype.dataChanged=function(){console.log("渲染更改了this.data:",this.data,this);for(var e=0;e<this.data.length;e++)this.data[e].status?(console.log("颜色：",this.colorList[this.data[e].color]),this["q"+(3-e)].fillColor=this.colorList[this.data[e].color],this["q"+(3-e)].fillAlpha=1):this["q"+(3-e)].fillAlpha=0},t}(eui.ItemRenderer);__reflect(jiugeItem.prototype,"jiugeItem"),window.Main=Main;